<!DOCTYPE html>
<head>
    <title> Painel Solar </title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="UTF-8">
    <script src='node_modules/socket.io-client/dist/socket.io.js'></script>
    <script src='node_modules/chart.js/dist/Chart.min.js'></script>
    <script src='node_modules/chart.js/dist/Chart.js'></script>
    <script src="client_util.js"></script>
</head>
<!--.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-.-->
<body class="background" >

    <div class="mainContainer" >
        
        <!-- Painel com informações mais gerais como tempo de servidor ligado -->
        <div class="panel" style="width: 600px ; text-shadow: 1px 1px 3px red" >
            <h1> Servidor </h1>
            <table style="width:95%">
                <tr>
                    <td>
                        <b>Tempo de servidor ligado:</b> 
                    </td>
                    <td>
                        <span id="uptime"></span>
                    </td>
                </tr>
                <tr>
                    <td>
                        <b>Carga da bateria:</b> 
                    </td>
                    <td>
                        <span id="charge"></span>%
                    </td>
                </tr>
            </table>
        </div>

        <!-- Painel de angulação -->
        <div class="panel" style="text-shadow: 1px 1px 3px violet">
            <h2>Angulação</h2>
            <table style="width: 95%">
                <tr><td><b>Ângulo atual:</b></td> <td><span id='last_angle'></span></td></tr>
                <tr><td><b>Angulação automática:</b></td> <td><input id='auto_angle' type="checkbox" disabled='true'> </td></tr>
            </table>
            <p> 
                <b>Fixar ângulo:</b> <span id='client_angle'></span> 
                <br>
                (-90°)<input id='angle_range' type="range" disabled='true' min="-90" max="90">(+90°)
            </p>

            <canvas id='angle_chart' width="400px" height="150px" ></canvas>
        </div>
        
        <!-- Painel com gráficos sobre corrente, carga etc -->
        <div class="panel" style="text-shadow: 1px 1px 3px rgba(110,110,255,1)">
            <h2>Corrente elétrica</h2>
            <b>Último valor lido:</b><span id='last_current_read'></span>
            <br>
            <canvas id='current_chart' width="400px" height="150px" ></canvas>
        </div>

        <!-- Painel com gráficos sobre a intensidade da luz -->
        <div class="panel" style="text-shadow: 1px 1px 3px yellow">
            <h2>Intensidade de luz</h2>
            <b>Valor atual:</b><span>a</span>
            <canvas id='ldr_chart' width="400px" height="150px" ></canvas>
        </div>

        <!-- Painel pra ???? -->
        <div class="panel" style="text-shadow: 1px 1px 3px rgba(110,255,111,1)">
            <h2>????</h2>
        </div>
                
    </div>

    <script>
        // DOM elements
        var dom_angle_range = document.getElementById('angle_range')
        var dom_last_angle_info = document.getElementById('last_angle')
        var dom_auto_angle = document.getElementById('auto_angle')
        var dom_client_angle = document.getElementById('client_angle')
        var dom_last_current_info = document.getElementById('last_current_read')

        var socket = io();
        var uptime_text = document.getElementById("uptime")
        var server_start_time = Date.now();
        

        // Atualizando o server uptime
        socket.on('server_start_time',function(arg){
            server_start_time = arg
            uptime_text.innerText = tempoEmString(Date.now() - server_start_time ); 
            setInterval(function(){
                uptime_text.innerText = tempoEmString(Date.now() - server_start_time ); 
            } , 1000 )
        })

        socket.on('server_data',function(arg){
            createLdrChart( arg , document.getElementById('ldr_chart') )
            createAngleChart( arg , document.getElementById('angle_chart') )
            createCurrentChart( arg , document.getElementById('current_chart'))

            dom_auto_angle.hidden = false
            dom_angle_range.hidden = false

            dom_auto_angle.disabled = false
            dom_auto_angle.checked = false // Ler estado do servidor
            dom_angle_range.disabled = dom_auto_angle.checked

            dom_auto_angle.onchange = function( ev ){
                var checked = dom_auto_angle.checked
                dom_angle_range.disabled = checked
                if( checked ){
                    dom_client_angle.innerText = ""
                }
                // Enviar para o servidor função de angulo automatico ou não
            }
            
            dom_angle_range.onmousemove = function(){
                if( dom_auto_angle.checked == false ){
                    dom_client_angle.innerText = dom_angle_range.value + "°"
                }
            }
            dom_angle_range.onchange = function(){
                if( dom_auto_angle.checked == false ){
                    // Enviar para o servidor um novo ângulo fixo
                    
                }
            }

        })

        


        

    </script>


</body>